<%- include('../partials/header') %>

  <section id="show-page">
    <div>Title: </div>
    <div>
      <%= song.title %>
    </div>
    <div>Artist: </div>
    <div>
      <%= song.artist %>
    </div>
    <div>Instrument: </div>
    <div>
      <%= song.instrument %>
    </div>
    <div>Future Performance?: </div>
    <div>
      <%= song.futurePerformance ? 'Yes' : 'Nope' %>
    </div>
  
  <% if (user) { %>
    <br><br>
    <h2>Comments</h2>
    <form id="add-comment-form" method="POST" action="/songs/<%= song._id %>/comments">
      <label>Comment:</label>
      <textarea name="content"></textarea>

      <input type="submit" value="Add Comment">
    </form>
    <% } %>


      <% if (song.comments.length) { %>
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Date</th>
              <th>Comment</th>
              <th>Completed?</th>
            </tr>
          </thead>
          <tbody>
            <% let total = 0 %>
            <% song.comments.forEach(function(r) { %>
              <tr>
                <td class="comment-user"><img alt="avatar" src="<%= r.userAvatar %>" referrerpolicy="no-referrer" ><%= r.userName %></td>
                <td><%= r.createdAt.toLocaleDateString() %></td>
                <td><%= r.content %></td>
                <td>
                  <% if (user?._id.equals(r.user)) { %>
                    <form action="/comments/<%= r._id %>?_method=DELETE" method="POST">
                      <button type="submit">X</button>
                    </form>
                  <% } %>
                </td>
              </tr>
         
            <% }); %>
            <tr>
              <td colspan="3"></td>
              <td><strong><%= (total / song.comments.length).toFixed(1) %></strong></td>
            </tr>
   
          </tbody>
        </table>
        
        <% } else { %>
          <h5>No Comments Yet</h5>
          <% } %>


            <%- include('../partials/footer') %>